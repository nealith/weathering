CXX=g++
LDLIBS= -L/lib `pkg-config --libs opencv`

ifeq ($(mode),debug)
	OPTIONS= -I./includes -I. -g -Wall -pg -no-pie
else
	mode = release
	OPTIONS= -I./includes -I. -Wall -O3
endif

SOURCES = ./src
INC = ./includes

OBJ = AverageSumError.o  \
FullBlocksGenerator.o  \
BorderKernelBlur.o  \
RandomBlocksGenerator.o  \
ClassicPositionChooser.o  \
SeamCarvingMaskGenerator.o  \
CORE.o \
TextureGenerator.o \
DiffSumSqrtAtIJ.o  \
TopTenBlockSelector.o  \
EpsilonBlockSelector.o \
SmoothMask.o \
NormalizedInvertedErrorMask.o \
TextureTransfert.o


#######	Build rules

.PHONY:all
all: information testGeneration testTransfert

information:
ifneq ($(mode),release)
ifneq ($(mode),debug)
	@echo "Invalid build mode."
	@echo "Please use 'make mode=release' or 'make mode=debug'"
	@exit 1
endif
endif
	@echo "Building on "$(mode)" mode"
	@echo ".........................."

testGeneration	: testGeneration.o $(OBJ)
	$(CXX) $(LDLIBS) $(OPTIONS) -o $@ $(OBJ) testGeneration.o

testTransfert	: testTransfert.o $(OBJ)
	$(CXX) $(LDLIBS) $(OPTIONS) -o $@ $(OBJ) testTransfert.o

testGeneration.o : testGeneration.cpp
	$(CXX) -c $(OPTIONS) $(LDLIBS) testGeneration.cpp -o $@

testTransfert.o : testTransfert.cpp
	$(CXX) -c $(OPTIONS) $(LDLIBS) testTransfert.cpp -o $@

AverageSumError.o : $(SOURCES)/AverageSumError.cpp $(INC)/AverageSumError.h
	$(CXX) -c $(OPTIONS) $(LDLIBS) $(SOURCES)/AverageSumError.cpp -o $@

FullBlocksGenerator.o : $(SOURCES)/FullBlocksGenerator.cpp $(INC)/FullBlocksGenerator.h
	$(CXX) -c $(OPTIONS) $(LDLIBS) $(SOURCES)/FullBlocksGenerator.cpp -o $@

BorderKernelBlur.o : $(SOURCES)/BorderKernelBlur.cpp $(INC)/BorderKernelBlur.h
	$(CXX) -c $(OPTIONS) $(LDLIBS) $(SOURCES)/BorderKernelBlur.cpp -o $@

RandomBlocksGenerator.o : $(SOURCES)/RandomBlocksGenerator.cpp $(INC)/RandomBlocksGenerator.h
	$(CXX) -c $(OPTIONS) $(LDLIBS) $(SOURCES)/RandomBlocksGenerator.cpp -o $@

ClassicPositionChooser.o : $(SOURCES)/ClassicPositionChooser.cpp $(INC)/ClassicPositionChooser.h
	$(CXX) -c $(OPTIONS) $(LDLIBS) $(SOURCES)/ClassicPositionChooser.cpp -o $@

SeamCarvingMaskGenerator.o : $(SOURCES)/SeamCarvingMaskGenerator.cpp $(INC)/SeamCarvingMaskGenerator.h
	$(CXX) -c $(OPTIONS) $(LDLIBS) $(SOURCES)/SeamCarvingMaskGenerator.cpp -o $@

CORE.o : $(SOURCES)/CORE.cpp $(INC)/CORE.h
	$(CXX) -c $(OPTIONS) $(LDLIBS) $(SOURCES)/CORE.cpp -o $@

TextureGenerator.o : $(SOURCES)/TextureGenerator.cpp $(INC)/TextureGenerator.h
	$(CXX) -c $(OPTIONS) $(LDLIBS) $(SOURCES)/TextureGenerator.cpp -o $@

DiffSumSqrtAtIJ.o : $(SOURCES)/DiffSumSqrtAtIJ.cpp $(INC)/DiffSumSqrtAtIJ.h
	$(CXX) -c $(OPTIONS) $(LDLIBS) $(SOURCES)/DiffSumSqrtAtIJ.cpp -o $@

TopTenBlockSelector.o : $(SOURCES)/TopTenBlockSelector.cpp $(INC)/TopTenBlockSelector.h
	$(CXX) -c $(OPTIONS) $(LDLIBS) $(SOURCES)/TopTenBlockSelector.cpp -o $@

EpsilonBlockSelector.o : $(SOURCES)/EpsilonBlockSelector.cpp $(INC)/EpsilonBlockSelector.h
	$(CXX) -c $(OPTIONS) $(LDLIBS) $(SOURCES)/EpsilonBlockSelector.cpp -o $@

SmoothMask.o : $(SOURCES)/SmoothMask.cpp $(INC)/SmoothMask.h
	$(CXX) -c $(OPTIONS) $(LDLIBS) $(SOURCES)/SmoothMask.cpp -o $@

NormalizedInvertedErrorMask.o : $(SOURCES)/NormalizedInvertedErrorMask.cpp $(INC)/NormalizedInvertedErrorMask.h
	$(CXX) -c $(OPTIONS) $(LDLIBS) $(SOURCES)/NormalizedInvertedErrorMask.cpp -o $@

TextureTransfert.o : $(SOURCES)/TextureTransfert.cpp $(INC)/TextureTransfert.h
	$(CXX) -c $(OPTIONS) $(LDLIBS) $(SOURCES)/TextureTransfert.cpp -o $@


.PHONY:clean
clean:
	find . -name "*.o" | xargs rm -vf
	rm -vf mainTest
